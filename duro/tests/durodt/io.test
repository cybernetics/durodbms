#!/bin/sh
# Execute tclsh from the user's PATH \
exec tclsh "$0" ${1+"$@"}

# $Id$
#
# Test scalar definitions and operations
#

package require tcltest 2.2
eval ::tcltest::configure $argv
namespace import ::tcltest::*

set testdir [::tcltest::configure -testdir]

test std_output {Standard output} -match regexp -body {
    exec $testdir/../../dli/durodt << {
        put('Test ');
        put(3);
        put(1.7);
        put(TRUE);
        put(X'446f');
        put(X'');

        put_line('Duro');
    }
} -result {Test 31.70*TRUEDoDuro
}

test file_output {File Output} -match regexp -body {
    exec $testdir/../../dli/durodt << {
        VAR is iostream_id;

        open(is, 'out.txt', 'w');

        put(is, 'Test ');
        put(is, 3);
        put(is, 1.7);
        put(is, TRUE);

        put_line(is, 'Duro');

        put(is, X'4464'); put_line('');

        close(is);
    }
    set f [open out.txt r]
    puts [read $f]
    close $f

    file delete -force out.txt
} -output {Test 31.70*TRUEDuro
Dd
}

test stdout_output {stdout output} -match regexp -body {
    exec $testdir/../../dli/durodt << {
        put(stdout, 'Test ');
        put(stdout, 3);
        put(stdout, 1.7);
        put(stdout, TRUE);
        put(stdout, X'444f');

        put_line(stdout, 'Duro');
    }
} -result {Test 31.70*TRUEDODuro
}

test stderr_output {stderr output} -match regexp -body {
    exec $testdir/../../dli/durodt << {
        put(stderr, 'Test ');
        put(stderr, 3);
        put(stderr, 1.7);
        put(stderr, TRUE);

        put_line(stderr, 'Duro');
    } 2> out.txt
    set f [open out.txt r]
    puts [read $f]
    close $f

    file delete -force out.txt
} -output {Test 31.70*TRUEDuro
}

test file_input {File input} -body {
    set f [open in.txt w]
    puts $f {Duro%$-}
    puts $f { xy= }
    close $f    

    set res [exec $testdir/../../dli/durodt << {
        VAR is iostream_id;

        open(is, 'in.txt', 'r');
        VAR line string;
        get_line(is, line);
        put_line(line);
        get_line(is, line);
        put_line(line);
        put(eof(is)); put_line('');
        get_line(is, line);
        put_line(line);
        put(eof(is)); put_line('');
        close(is);

        open(is, 'in.txt', 'r');
        VAR bin binary;
        read(is, bin, 7);
        close(is);
        put(bin); put_line('');
    }]
    file delete -force in.txt
    return $res
} -result {Duro%$-
 xy= 
FALSE

TRUE
Duro%$-
}

cleanupTests
