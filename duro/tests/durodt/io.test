#!/bin/sh
# Execute tclsh from the user's PATH \
exec tclsh "$0" ${1+"$@"}

# $Id$
#
# Test scalar definitions and operations
#

package require tcltest 2.2
eval ::tcltest::configure $argv
namespace import ::tcltest::*

set testdir [::tcltest::configure -testdir]

test def_output {Default output} -match regexp -body {
    exec $testdir/../../dli/durodt << {
        put('Test ');
        put(3);
        put(1.7);
        put(TRUE);

        put_line('Duro');
    }
} -result {Test 31.70*TRUEDuro
}

test file_output {File Output} -match regexp -body {
    exec $testdir/../../dli/durodt << {
        VAR is IO_STREAM;

        OPEN(is, 'out.txt', 'w');

        put(is, 'Test ');
        put(is, 3);
        put(is, 1.7);
        put(is, TRUE);

        put_line(is, 'Duro');

        CLOSE(is);
    }
    set f [open out.txt r]
    puts [read $f]
    close $f

    file delete -force out.txt
} -output {Test 31.70*TRUEDuro
}

test stdout_output {STDOUT output} -match regexp -body {
    exec $testdir/../../dli/durodt << {
        put(STDOUT, 'Test ');
        put(STDOUT, 3);
        put(STDOUT, 1.7);
        put(STDOUT, TRUE);

        put_line(STDOUT, 'Duro');
    }
} -result {Test 31.70*TRUEDuro
}

test stderr_output {STDERR output} -match regexp -body {
    exec $testdir/../../dli/durodt << {
        put(STDERR, 'Test ');
        put(STDERR, 3);
        put(STDERR, 1.7);
        put(STDERR, TRUE);

        put_line(STDERR, 'Duro');
    } 2> out.txt
    set f [open out.txt r]
    puts [read $f]
    close $f

    file delete -force out.txt
} -output {Test 31.70*TRUEDuro
}

test file_input {File input} -body {
    set f [open in.txt w]
    puts $f {Duro%$-}
    close $f    

    set res [exec $testdir/../../dli/durodt << {
        VAR IS IO_STREAM;

        OPEN(IS, 'in.txt', 'r');
        VAR LINE STRING;
        get_line(IS, LINE);
        put_line(LINE);
        CLOSE(IS);
    }]
    file delete -force in.txt
    return $res
} -result {Duro%$-
}
