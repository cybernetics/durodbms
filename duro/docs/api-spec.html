<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
<title>Duro API specification</title>
<body>
<!-- $Id$ -->
<h1>Duro API specification</h1>

<p>- DRAFT -

<h2>Contents</h2>

<p><a href="#built-in-types">Built-in types</a>

<h3>Table functions</h3>

<ul>
<li><a href="#create_table">RDB_create_table</a>
<li><a href="#get_table">RDB_get_table</a>
<li><a href="#drop_table">RDB_drop_table</a>
<li><a href="#table_name">RDB_table_name</a>
<li><a href="#set_table_name">RDB_set_table_name</a>
<li><a href="#make_persistent">RDB_make_persistent</a>
<li><a href="#table_contains">RDB_table_contains</a>
<li><a href="#aggregate">RDB_aggregate</a>
<li><a href="#table_is_empty">RDB_table_is_empty</a>
<li><a href="#insert">RDB_insert</a>
<li><a href="#update">RDB_update</a>
<li><a href="#delete">RDB_delete</a>
<li><a href="#extract_tuple">RDB_extract_tuple</a>
<li><a href="#copy_table">RDB_copy_table</a>
<li><a href="#rename">RDB_rename</a>
<li><a href="#select">RDB_select</a>
<li><a href="#extend">RDB_extend</a>
<li><a href="#project">RDB_project</a>
<li><a href="#join">RDB_join</a>
<li><a href="#union">RDB_union</a>
<li><a href="#intersect">RDB_intersect</a>
<li><a href="#minus">RDB_minus</a>
<li><a href="#divide">RDB_divide</a>
<li><a href="#gdivide">RDB_gdivide</a>
<li><a href="#summarize">RDB_summarize</a>
<li><a href="#wrap">RDB_wrap</a>
<li><a href="#unwrap">RDB_unwrap</a>
<li><a href="#group">RDB_group</a>
<li><a href="#ungroup">RDB_ungroup</a>
</ul>

<h3>Tuple functions</h3>

<ul>
<li><a href="#init_tuple">RDB_init_tuple</a>
<li><a href="#destroy_tuple">RDB_destroy_tuple</a>
<li><a href="#tuple_set">RDB_tuple_set</a>
<li><a href="#tuple_set_bool">RDB_tuple_set_bool</a>
<li><a href="#tuple_set_int">RDB_tuple_set_int</a>
<li><a href="#tuple_set_rational">RDB_tuple_set_rational</a>
<li><a href="#tuple_set_string">RDB_tuple_set_string</a>
<li><a href="#tuple_get">RDB_tuple_get</a>
<li><a href="#tuple_get_bool">RDB_tuple_get_bool</a>
<li><a href="#tuple_get_int">RDB_tuple_get_int</a>
<li><a href="#tuple_get_rational">RDB_tuple_get_rational</a>
<li><a href="#tuple_get_string">RDB_tuple_get_string</a>
<li><a href="#tuple_extend">RDB_tuple_extend</a>
<li><a href="#tuple_rename">RDB_tuple_rename</a>
<li><a href="#tuple_wrap">RDB_tuple_wrap</a>
<li><a href="#tuple_unwrap">RDB_tuple_unwrap</a>
</ul>

<h3>RDB_value functions</h3>

<ul>
<li><a href="#init_value">RDB_init_value</a>
<li><a href="#destroy_value">RDB_destroy_value</a>
<li><a href="#value_equals">RDB_value_equals</a>
<li><a href="#copy_value">RDB_copy_value</a>
<li><a href="#select_value">RDB_select_value</a>
<li><a href="#value_set_bool">RDB_value_set_bool</a>
<li><a href="#value_set_int">RDB_value_set_int</a>
<li><a href="#value_set_rational">RDB_value_set_rational</a>
<li><a href="#value_set_string">RDB_value_set_string</a>
<li><a href="#value_set_tuple">RDB_value_set_tuple</a>
<li><a href="#value_set_array">RDB_value_set_array</a>
<li><a href="#value_set_table">RDB_value_set_table</a>
<li><a href="#value_bool">RDB_value_bool</a>
<li><a href="#value_int">RDB_value_int</a>
<li><a href="#value_rational">RDB_value_rational</a>
<li><a href="#value_string">RDB_value_string</a>
<li><a href="#value_get_comp">RDB_value_get_comp</a>
<li><a href="#value_set_comp">RDB_value_set_comp</a>
<li><a href="#binary_get">RDB_binary_get</a>
<li><a href="#binary_set">RDB_binary_set</a>
<li><a href="#binary_length">RDB_binary_length</a>
</ul>

<h3>Database functions</h3>

<ul>
<li><a href="#create_db_from_env">RDB_create_db_from_env</a>
<li><a href="#get_db_from_env">RDB_get_db_from_env</a>
<li><a href="#release_db">RDB_release_db</a>
<li><a href="#drop_db">RDB_drop_db</a>
<li><a href="#db_name">RDB_db_name</a>
</ul>

<h3>Transaction functions</h3>

<ul>
<li><a href="#begin_tx">RDB_begin_tx</a>
<li><a href="#commit">RDB_commit</a>
<li><a href="#rollback">RDB_rollback</a>
<li><a href="#tx_is_db">RDB_tx_db</a>
<li><a href="#tx_is_running">RDB_tx_is_running</a>
</ul>

<h3>Array functions</h3>

<ul>
<li><a href="#init_array">RDB_init_array</a>
<li><a href="#destroy_array">RDB_destroy_array</a>
<li><a href="#table_to_array">RDB_table_to_array</a>
<li><a href="#array_get_tuple">RDB_array_get_tuple</a>
<li><a href="#array_set_tuple">RDB_array_set_tuple</a>
<li><a href="#array_length">RDB_array_length</a>
<li><a href="#resize_array">RDB_resize_array</a>
</ul>

<h3>Expression functions</h3>

<ul>
<li><a href="#expr_type">RDB_expr_type</a>
<li><a href="#expr_is_const">RDB_expr_is_const</a>
<li><a href="#bool_const">RDB_bool_const</a>
<li><a href="#int_const">RDB_int_const</a>
<li><a href="#rational_const">RDB_rational_const</a>
<li><a href="#string_const">RDB_string_const</a>
<li><a href="#value_const">RDB_value_const</a>
<li><a href="#expr_attr">RDB_expr_attr</a>
<li><a href="#eq">RDB_eq</a>
<li><a href="#neq">RDB_neq</a>
<li><a href="#lt">RDB_lt</a>
<li><a href="#gt">RDB_gt</a>
<li><a href="#let">RDB_let</a>
<li><a href="#get">RDB_get</a>
<li><a href="#and">RDB_and</a>
<li><a href="#or">RDB_or</a>
<li><a href="#not">RDB_not</a>
<li><a href="#add">RDB_add</a>
<li><a href="#subtract">RDB_subtract</a>
<li><a href="#strlen">RDB_strlen</a>
<li><a href="#regmatch">RDB_regmatch</a>
<li><a href="#rel_table">RDB_rel_table</a>
<li><a href="#rel_is_empty">RDB_rel_is_empty</a>
<li><a href="#aggregate_expr">RDB_aggregate_expr</a>
<li><a href="#get_comp">RDB_get_comp</a>
<li><a href="#selector">RDB_selector</a>
<li><a href="#user_op">RDB_user_op</a>
<li><a href="#drop_expr">RDB_drop_expr</a>
</ul>

<h3>Type functions</h3>

<ul>
<li><a href="#define_type">RDB_define_type</a>
<li><a href="#implement_type">RDB_implement_type</a>
<li><a href="#create_tuple_type">RDB_create_tuple_type</a>
<li><a href="#create_relation_type">RDB_create_relation_type</a>
<li><a href="#get_type">RDB_get_type</a>
<li><a href="#drop_type">RDB_drop_type</a>
<li><a href="#type_name">RDB_type_name</a>
<li><a href="#type_is_scalar">RDB_type_is_scalar</a>
<li><a href="#type_is_numeric">RDB_type_is_numeric</a>
<li><a href="#type_equals">RDB_type_equals</a>
<li><a href="#extend_tuple_type">RDB_extend_tuple_type</a>
<li><a href="#extend_relation_type">RDB_extend_relation_type</a>
<li><a href="#join_tuple_types">RDB_join_tuple_types</a>
<li><a href="#join_relation_types">RDB_join_relation_types</a>
<li><a href="#project_tuple_type">RDB_project_tuple_type</a>
<li><a href="#project_relation_type">RDB_project_relation_type</a>
<li><a href="#rename_tuple_type">RDB_rename_tuple_type</a>
<li><a href="#rename_relation_type">RDB_rename_relation_type</a>
</ul>

<h3>Operator functions</h3>

<ul>
<li><a href="#define_ro_op">RDB_define_ro_op</a>
<li><a href="#define_upd_op">RDB_define_upd_op</a>
<li><a href="#call_ro_op">RDB_call_ro_op</a>
<li><a href="#call_upd_op">RDB_call_upd_op</a>
<li><a href="#drop_op">RDB_drop_op</a>
</ul>

<h3>Constraint functions</h3>

<ul>
<li><a href="#create_constraint">RDB_create_constraint</a>
<li><a href="#drop_constraint">RDB_drop_constraint</a>
<li><a href="#begin_uoi">RDB_begin_uio</a>
<li><a href="#end_uoi">RDB_end_uio</a>
</ul>

<h3>Database Environment functions</h3>

<ul>
<li><a href="#create_env">RDB_create_env</a>
<li><a href="#open_env">RDB_open_env<a>
<li><a href="#close_env">RDB_close_env</a>
<li><a href="#set_errfile">RDB_set_errfile</a>
</ul>

<h3>Miscellaneous</h3>

<ul>
<li><a href="#getargs">RDB_getargs</a>
</ul>

<h3>C structures</h3>

<ul>
<li><a href="#attr">RDB_attr</a>
<li><a href="#possrep">RDB_possrep</a>
</ul>

<h2 id="built-in-types">Built-in types</h2>

<table border="1">
<tr><th>Name<th>RDB_type variable<th>C type
<tr><td>BOOLEAN<td>RDB_BOOLEAN<td>RDB_bool
<tr><td>INTEGER<td>RDB_INTEGER<td>RDB_int
<tr><td>RATIONAL<td>RDB_RATIONAL<td>RDB_rational
<tr><td>STRING<td>RDB_STRING<td>char *
<tr><td>BINARY<td>RDB_BINARY<td>&nbsp;-
</table>

<hr>

<h2 id="create_table">RDB_create_table</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef struct {
    int attrc;
    char **attrv;
} RDB_key_attrs;

int
RDB_create_table(const char *name, RDB_bool persistent,
                 int attrc, RDB_attr attrv[],
                 int keyc, RDB_key_attrs keyv[],
                 RDB_transaction *txp, RDB_table **tbpp);
</pre>

<h3>Description</h3>

<p>RDB_create_table creates a table with name <var>name</var> under the control of
the transaction pointed to by <var>txp</var>.
A pointer to the newly created RDB_table structure
will be stored at the location pointed to by <var>tbpp</var>.

<p>If <var>persistent</var> is RDB_FALSE, a transient table will be created.
In this case, <var>name</var> may be NULL.

<p>If <var>persistent</var> is RDB_TRUE, a persistent table in the database associated
with the transaction pointed to by <var>txp</var> will be created.

<p>The attributes of the table are specified by <var>attrc</var> and
<var>attrv</var>.

<p>The candidate keys are specified by <var>keyc</var> and <var>keyv</var>.
At least one candidate key must be specified.

<p>If the operations fails for a system error, the transaction is rolled
back.

<h3>Return value</h3>

<p>On success, RDB_OK is returned. Any other return value indicates an error.

<h3>Errors</h3>

<hr>

<h2 id="get_table">RDB_get_table</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_get_table(const char *name, RDB_transaction *txp, RDB_table **tbpp);
</pre>

<hr>

<h2 id="drop_table">RDB_drop_table</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_drop_table(RDB_table *tbp, RDB_transaction *);
</pre>

<hr>

<h2 id="table_name">RDB_table_name</h2>

<pre>
#include &lt;rel/rdb.h&gt;

char *
RDB_table_name(RDB_table *tbp)
</pre>

<hr>

<h2 id="set_table_name">RDB_set_table_name</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_set_table_name(RDB_table *tbp, const char *name, RDB_transaction *);
</pre>

<hr>

<h2 id="make_persistent">RDB_make_persistent</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_make_persistent(RDB_table *, RDB_transaction *);
</pre>

<hr>

<h2 id="table_contains">RDB_table_contains</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_table_contains(RDB_table *, const RDB_tuple *, RDB_transaction *);
</pre>

<hr>

<h2 id="aggregate">RDB_aggregate</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef enum {
    RDB_COUNT, RDB_SUM, RDB_AVG, RDB_MAX, RDB_MIN, RDB_ALL, RDB_ANY,
    RDB_COUNTD, RDB_SUMD, RDB_AVGD
} RDB_aggregate_op;

int
RDB_aggregate(RDB_table *, RDB_aggregate_op op, const char *attrname,
              RDB_transaction *, RDB_value *resultp);
</pre>

<hr>

<h2 id="table_is_empty">RDB_table_is_empty</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_table_is_empty(RDB_table *, RDB_transaction *, RDB_bool *resultp);
</pre>

<hr>

<h2 id="insert">RDB_insert</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_insert(RDB_table *tbp, const RDB_tuple *tplp, RDB_transaction *);
</pre>

<hr>

<h2 id="update">RDB_update</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef struct {
    char *name;
    RDB_expression *exp;
} RDB_attr_update;

int
RDB_update(RDB_table *, RDB_expression *, int attrc,
        const RDB_attr_update attrv[], RDB_transaction *txp);
</pre>

<h3>Return value</h3>

<p>On success, RDB_OK is returned. Any other return value indicates an error.

<h3>Errors</h3>

<dl>
<dt>RDB_INVALID_TRANSACTION
<dd><var>txp</var> does not point to a running transaction.

<dt>RDB_INVALID_ARGUMENT
<dd>One of the attributes in <var>attrv</var> does not exist in the table.

<dt>RDB_TYPE_MISMATCH
<dd>The type of one the expressions in <var>attrv</var> is not the same
as the type of the corresponding table attribute.

<dt>RDB_NOT_SUPPORTED
<dd>RDB_update is not supported for this type of table in this version of
the library.

<dt>Other
<dd>A system error occured.
</dl>

<hr>

<h2 id="delete">RDB_delete</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_delete(RDB_table *tbp, RDB_expression *exprp, RDB_transaction *);
</pre>

<hr>

<h2 id="extract_tuple">RDB_extract_tuple</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_extract_tuple(RDB_table *, RDB_tuple *, RDB_transaction *);
</pre>

<hr>

<h2 id="copy_table">RDB_copy_table</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_copy_table(RDB_table *dstp, RDB_table *srcp, RDB_transaction *);
</pre>

<hr>

<h2 id="rename">RDB_rename</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef struct {
    char *from;
    char *to;
} RDB_renaming;

int
RDB_rename(RDB_table *tbp, int renc, RDB_renaming renv[],
           RDB_table **resultpp);
</pre>

<hr>

<h2 id="select">RDB_select</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_select(RDB_table *, RDB_expression *condition, RDB_table **resultpp);
</pre>

<hr>

<h2 id="extend">RDB_extend</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef struct RDB_virtual_attr {
    char *name;
    RDB_expression *value;
} RDB_virtual_attr;

int
RDB_extend(RDB_table *, int attrc, RDB_virtual_attr attrv[],
        RDB_table **resultpp);
</pre>

<hr>

<h2 id="project">RDB_project</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_project(RDB_table *, int attrc, char *attrv[], RDB_table **resultpp);
</pre>

<hr>

<h2 id="join">RDB_join</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_join(RDB_table *tb1p, RDB_table *tb2p, RDB_table **resultpp);
</pre>

<h3>Description</h3>

<p>RDB_join creates a table which is a natural join of the two tables
represented by <var>tb1p</var> and <var>tb2p</var>.

<hr>

<h2 id="union">RDB_union</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_union(RDB_table *, RDB_table *, RDB_table **resultpp);
</pre>

<hr>

<h2 id="intersect">RDB_intersect</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_intersect(RDB_table *, RDB_table *, RDB_table **resultpp);
</pre>

<h3>Description</h3>

<p>RDB_intersect creates a virtual table which contains
all tuples which are an element of the two tables
represented by the <var>tb1p</var> and <var>tb2p</var> arguments.

<hr>

<h2 id="minus">RDB_minus</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_minus(RDB_table *, RDB_table *, RDB_table **resultpp);
</pre>

<hr>

<h2 id="divide">RDB_divide</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_divide(RDB_table *, RDB_table *, RDB_table *, RDB_table **resultpp);
</pre>

<hr>

<h2 id="gdivide">RDB_gdivide</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_gdivide(RDB_table *, RDB_table *, RDB_table *, RDB_table *,
           RDB_table **resultpp);
</pre>

<hr>

<h2 id="summarize">RDB_summarize</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef struct {
    RDB_aggregate_op op;
    RDB_expression *exp;
    char *name;
} RDB_summarize_add;

int
RDB_summarize(RDB_table *, RDB_table *, int addc, RDB_summarize_add addv[],
              RDB_table **resultpp);
</pre>

<hr>

<h2 id="wrap">RDB_wrap</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef struct {
    int attrc;
    char **attrv;
    int gattrc;
} RDB_wrapping;

int
RDB_wrap(RDB_table *tbp, int wrapc, RDB_wrapping wrapv[],
         RDB_table **resultpp);
</pre>

<hr>

<h2 id="unwrap">RDB_unwrap</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_unwrap(RDB_table *, int attrc, const char *attrv[], RDB_table **);
</pre>

<hr>

<h2 id="group">RDB_group</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_group(RDB_table *, int attrc, char *attrv[], const char *,
         RDB_table **resultpp);
</pre>

<hr>

<h2 id="ungroup">RDB_ungroup</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_ungroup(RDB_table *, const char *, RDB_table **resultpp);
</pre>

<hr>

<h2 id="init_tuple">RDB_init_tuple</h2>

<pre>
#include &lt;rel/rdb.h&gt;

void
RDB_init_tuple(RDB_tuple *);
</pre>

<hr>

<h2 id="destroy_tuple">RDB_destroy_tuple</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_destroy_tuple(RDB_tuple *);
</pre>

<hr>

<h2 id="tuple_set">RDB_tuple_set</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_tuple_set(RDB_tuple *, const char *name, const RDB_value *);
</pre>

<hr>

<h2 id="tuple_set_bool">RDB_tuple_set_bool</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_tuple_set_bool(RDB_tuple *, const char *name, RDB_bool val);
</pre>

<hr>

<h2 id="tuple_set_int">RDB_tuple_set_int</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_tuple_set_int(RDB_tuple *, const char *name, RDB_int val);
</pre>

<hr>

<h2 id="tuple_set_rational">RDB_tuple_set_rational</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_tuple_set_rational(RDB_tuple *, const char *name, RDB_rational val);
</pre>

<hr>

<h2 id="tuple_set_string">RDB_tuple_set_string</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_tuple_set_string(RDB_tuple *, const char *name, const char *valp);
</pre>

<hr>

<h2 id="tuple_get">RDB_tuple_get</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_value *
RDB_tuple_get(const RDB_tuple *, const char *name);
</pre>

<hr>

<h2 id="tuple_get_bool">RDB_tuple_get_bool</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_bool
RDB_tuple_get_bool(const RDB_tuple *, const char *name);
</pre>

<hr>

<h2 id="tuple_get_int">RDB_tuple_get_int</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_int
RDB_tuple_get_int(const RDB_tuple *, const char *name);
</pre>

<hr>

<h2 id="tuple_get_rational">RDB_tuple_get_rational</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_rational
RDB_tuple_get_rational(const RDB_tuple *, const char *name);
</pre>

<hr>

<h2 id="tuple_get_string">RDB_tuple_get_string</h2>

<pre>
#include &lt;rel/rdb.h&gt;

char *
RDB_tuple_get_string(const RDB_tuple *, const char *name);
</pre>

<hr>

<h2 id="tuple_extend">RDB_tuple_extend</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_tuple_extend(RDB_tuple *, int attrc, RDB_virtual_attr attrv[],
                 RDB_transaction *);
</pre>

<hr>

<h2 id="tuple_wrap">RDB_tuple_wrap</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef struct {
    int attrc;
    char **attrv;
    int gattrc;
} RDB_wrapping;

int
RDB_tuple_wrap(const RDB_tuple *, int wrapc, RDB_wrapping wrapv[], RDB_tuple *);
</pre>

<hr>

<h2 id="tuple_unwrap">RDB_tuple_unwrap</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_tuple_unwrap(const RDB_tuple *, int attrc, const char *attrv[]);
</pre>

<hr>

<h2 id="init_value">RDB_init_value</h2>

<pre>
#include &lt;rel/rdb.h&gt;

void
RDB_init_value(RDB_value *valp);
</pre>

<hr>

<h2 id="destroy_value">RDB_destroy_value</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_destroy_value(RDB_value *valp);
</pre>

<hr>

<h2 id="value_equals">RDB_value_equals</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_bool
RDB_value_equals(const RDB_value *, const RDB_value *);
</pre>

<hr>

<h2 id="copy_value">RDB_copy_value</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_copy_value(RDB_value *dstvalp, const RDB_value *srcvalp);
</pre>

<hr>

<h2 id="select_value">RDB_select_value</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_select_value(RDB_value *valp, RDB_type *, const char *repname,
              RDB_value *compv[][B);
</pre>

<hr>

<h2 id="value_set_bool">RDB_value_set_bool</h2>

<pre>
#include &lt;rel/rdb.h&gt;

void
RDB_value_set_bool(RDB_value *valp, RDB_bool v);
</pre>

<hr>

<h2 id="value_set_int">RDB_value_set_int</h2>

<pre>
#include &lt;rel/rdb.h&gt;

void
RDB_value_set_int(RDB_value *valp, RDB_int v);
</pre>

<hr>

<h2 id="value_set_rational">RDB_value_set_rational</h2>

<pre>
#include &lt;rel/rdb.h&gt;

void
RDB_value_set_rational(RDB_value *valp, RDB_rational v);
</pre>

<hr>

<h2 id="value_set_string">RDB_value_set_string</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_value_set_string(RDB_value *valp, const char *str);
</pre>

<hr>

<h2 id="value_bool">RDB_value_bool</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_bool
RDB_value_bool(const RDB_value *valp);
</pre>

<hr>

<h2 id="value_int">RDB_value_int</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_int
RDB_value_int(const RDB_value *valp);
</pre>

<hr>

<h2 id="value_rational">RDB_value_rational</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_rational
RDB_value_rational(const RDB_value *valp);
</pre>

<hr>

<h2 id="value_string">RDB_value_string</h2>

<pre>
#include &lt;rel/rdb.h&gt;

char *
RDB_value_string(RDB_value *valp);
</pre>

<hr>

<h2 id="value_get_comp">RDB_value_get_comp</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_value_get_comp(const RDB_value *valp, const char *compname,
                   RDB_value *comp);
</pre>

<hr>

<h2 id="value_set_comp">RDB_value_set_comp</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_value_set_comp(RDB_value *valp, const char *compname,
                   const RDB_value *comp);
</pre>

<hr>

<h2 id="binary_set">RDB_binary_set</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_binary_set(RDB_value *, size_t pos, void *srcp, size_t len);
</pre>

<hr>

<h2 id="binary_get">RDB_binary_get</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_binary_get(const RDB_value *, size_t pos, void *dstp, size_t len);
</pre>

<hr>

<h2 id="binary_length">RDB_binary_length</h2>

<pre>
#include &lt;rel/rdb.h&gt;

size_t
RDB_binary_length(const RDB_value *);
</pre>

<hr>

<h2 id="create_db_from_env">RDB_create_db_from_env</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_create_db_from_env(const char *name, RDB_environment *envp, RDB_database **dbpp);
</pre>

<hr>

<h2 id="get_db_from_env">RDB_get_db_from_env</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_get_db_from_env(const char *name, RDB_environment *, RDB_database **dbpp);
</pre>

<hr>

<h2 id="release_db">RDB_release_db</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_release_db(RDB_database *dbp);
</pre>

<hr>

<h2 id="drop_db">RDB_drop_db</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_drop_db(const char *name, RDB_environment *);
</pre>

<hr>

<h2 id="db_name">RDB_db_name</h2>

<pre>
#include &lt;rel/rdb.h&gt;

char *RDB_db_name(RDB_database *dbp)
</pre>

<hr>

<h2 id="begin_tx">RDB_begin_tx</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_begin_tx(RDB_transaction *txp, RDB_database *dbp,
        RDB_transaction *parent);
</pre>

<hr>

<h2 id="commit">RDB_commit</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_commit(RDB_transaction *);
</pre>

<hr>

<h2 id="rollback">RDB_rollback</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_rollback(RDB_transaction *);
</pre>

<hr>

<h2 id="tx_db">RDB_tx_db</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_database *
RDB_tx_db(RDB_transaction *)
</pre>

<hr>

<h2 id="tx_is_running">RDB_tx_is_running</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_bool
RDB_tx_is_running(RDB_transaction *);
</pre>

<hr>

<h2 id="init_array">RDB_init_array</h2>

<pre>
#include &lt;rel/rdb.h&gt;

void
RDB_init_array(RDB_array *);
</pre>

<hr>

<h2 id="destroy_array">RDB_destroy_array</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_destroy_array(RDB_array *);
</pre>

<hr>

<h2 id="table_to_array">RDB_table_to_array</h2>

<pre>
#include &lt;rel/rdb.h&gt;

typedef struct {
    char *attrname;
    RDB_bool asc;
} RDB_seq_item;

int
RDB_table_to_array(RDB_table *, RDB_array *arrp,
                   int seqitc, RDB_seq_item seqitv[],
                   RDB_transaction *);
</pre>

<hr>

<h2 id="array_get_tuple">RDB_array_get_tuple</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_array_get_tuple(RDB_array *, RDB_int idx, RDB_tuple *);
</pre>

<hr>

<h2 id="array_set_tuple">RDB_array_set_tuple</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_array_set_tuple(RDB_array *, RDB_int idx, const RDB_tuple *);
</pre>

<hr>

<h2 id="array_length">RDB_array_length</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_array_length(RDB_array *);
</pre>

<hr>

<h2 id="resize_array">RDB_resize_array</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_resize_array(RDB_array *);
</pre>

<hr>

<h2 id="expr_type">RDB_expr_type</h2>

<pre>
RDB_type *
RDB_expr_type(const RDB_expression *);
</pre>

<hr>

<h2 id="is_const">RDB_is_const</h2>

<pre>
RDB_bool
RDB_expr_is_const(const RDB_expression *);
</pre>

<hr>

<h2 id="bool_const">RDB_bool_const</h2>

<pre>
RDB_expression *
RDB_bool_const(RDB_bool);
</pre>

<hr>

<h2 id="int_const">RDB_int_const</h2>

<pre>
RDB_expression *
RDB_int_const(RDB_int);
</pre>

<hr>

<h2 id="rational_const">RDB_rational_const</h2>

<pre>
RDB_expression *
RDB_rational_const(RDB_rational);
</pre>

<hr>

<h2 id="string_const">RDB_string_const</h2>

<pre>
RDB_expression *
RDB_string_const(const char *);
</pre>

<hr>

<h2 id="value_const">RDB_value_const</h2>

<pre>
RDB_expression *
RDB_value_const(const RDB_value *valp);
</pre>

<hr>

<h2 id="expr_attr">RDB_expr_attr</h2>

<pre>
RDB_expression *
RDB_expr_attr(const char *attrname, RDB_type *);
</pre>

<hr>

<h2 id="eq">RDB_eq</h2>

<pre>
RDB_expression *
RDB_eq(RDB_expression *, RDB_expression *);
</pre>

<hr>

<h2 id="neq">RDB_neq</h2>

<pre>
RDB_expression *
RDB_neq(RDB_expression *, RDB_expression *);
</pre>

<hr>

<h2 id="and">RDB_and</h2>

<pre>
RDB_expression *
RDB_and(RDB_expression *, RDB_expression *);
</pre>

<hr>

<h2 id="or">RDB_or</h2>

<pre>
RDB_expression *
RDB_or(RDB_expression *, RDB_expression *);
</pre>

<hr>

<h2 id="not">RDB_not</h2>

<pre>
RDB_expression *
RDB_not(RDB_expression *);
</pre>

<hr>

<h2 id="add">RDB_add</h2>

<pre>
RDB_expression *
RDB_add(RDB_expression *, RDB_expression *);
</pre>

<hr>

<h2 id="subtract">RDB_subtract</h2>

<pre>
RDB_expression *
RDB_subtract(RDB_expression *, RDB_expression *);
</pre>

<hr>

<h2 id="strlen">RDB_strlen</h2>

<pre>
RDB_expression *
RDB_strlen(RDB_expression *arg);
</pre>

<hr>

<h2 id="regmatch">RDB_regmatch</h2>

<pre>
RDB_expression *
RDB_regmatch(RDB_expression *arg1, RDB_expression *arg2);
</pre>

<hr>

<h2 id="rel_table">RDB_rel_table</h2>

<pre>
RDB_expression *
RDB_rel_table(RDB_table *);
</pre>

<hr>

<h2 id="rel_is_empty">RDB_rel_is_empty</h2>

<pre>
RDB_expression *
RDB_rel_is_empty(RDB_expression *);
</pre>

<hr>

<h2 id="aggregate_expr">RDB_aggregate_expr</h2>

<pre>
RDB_expression *
RDB_aggregate_expr(RDB_table *, RDB_aggregate_op op, const char *attrname);
</pre>

<hr>

<h2 id="get_comp">RDB_get_comp</h2>

<pre>
RDB_expression *
RDB_get_comp(RDB_expression *arg, const char *compname);
</pre>

<hr>

<h2 id="selector">RDB_selector</h2>

<pre>
RDB_expression *
RDB_selector(RDB_type *, const char *repname, RDB_expression *argv[]);
</pre>

<hr>

<h2 id="user_op">RDB_user_op</h2>

<pre>
RDB_expression *
RDB_user_op(const char *opname, RDB_attr *argv[]);
</pre>

<hr>

<h2 id="drop_expr">RDB_drop_expr</h2>

<pre>
void
RDB_drop_expr(RDB_expression *exp);
</pre>

<h3>Description</h3>

<p>RDB_drop_expr frees the memory pointed to by <var>exprp</var> and calls
RDB_drop_expr on all subexpressions.

<hr>

<h2 id="define_type">RDB_define_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_define_type(const char *name, int repc, RDB_possrep repv[],
                RDB_transaction *txp);
</pre>

<hr>

<h2 id="implement_type">RDB_implement_type</h2>

<pre>
#include &lt;rel/typeimpl.h&gt;

int
RDB_implement_type(const char *name, const char *libname, RDB_type *arep, int options,
                   size_t ireplen, RDB_transaction *);
</pre>

<h3>Description</h3>

<p>RDB_implement_type implements the user-defined type with name
<var>name</var>. When RDB_implement_type was inkoved successfully,
the type may be used for local variables and relvar attributes.
The actual representation is denoted by the <var>arep</var> argument.

<p>If <var>modname</var> is not NULL, it is taken as a name of a library
which contains the getter functions, setter functions, and selector
functions for the type.

<p>If <var>modname</var> is NULL, the getter functions, setter functions, and selector
functions for the type are provided by the system. In this case,
<var>arep</var> must be NULL, the type may only have one possible representation,
and this representation is also the actual representation.

<h4>Conventions for user-supplied selector, setter, and getter
functions</h4>

<p>The functions provided in a user-supplied library must obey the following
conventions:

<pre>
int
RDBU_select_<var>possrep</var>(RDB_value *valp, RDB_value *compv[],
        RDB_type *, const char *possrepname);
</pre>

<pre>
int
RDBU_set_<var>component</var>(RDB_value *valp, const RDB_value *comp,
        RDB_type *, const char *compname);
</pre>

<pre>
int
RDBU_get_<var>component</var>(const RDB_value *src, RDB_value *comp,
        RDB_type *, const char *compname);
</pre>

<h3>Return value</h3>

<p>On success, RDB_OK is returned. Any other return value indicates an error.

<h3>Errors</h3>

<dl>
<dt>RDB_INVALID_ARGUMENT
<dd>An invalid combination of <var>modname</var> and <var>arep</var> was
used.
<dt>RDB_NOT_SUPPORTED
<dd>The requested internal representation is not supported by this version
of the library.
<dt>...
</dl>

<hr>

<h2 id="create_tuple_type">RDB_create_tuple_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_type *
RDB_create_tuple_type(int attrc, RDB_attr attrv[]);
</pre>

<hr>

<h2 id="create_relation_type">RDB_create_relation_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_type *
RDB_create_relation_type(int attrc, RDB_attr attrv[]);
</pre>

<hr>

<h2 id="get_type">RDB_get_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_get_type(const char *name, RDB_transaction *, RDB_type **typp);
</pre>

<hr>

<h2 id="drop_type">RDB_drop_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

void
RDB_drop_type(RDB_type *);
</pre>

<hr>

<h2 id="type_name">RDB_type_name</h2>

<pre>
#include &lt;rel/rdb.h&gt;

char *
RDB_type_name(const RDB_type *);
</pre>

<hr>

<h2 id="type_is_scalar">RDB_type_is_scalar</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_bool
RDB_type_is_scalar(const RDB_type *);
</pre>

<hr>

<h2 id="type_is_numeric">RDB_type_is_numeric</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_bool
RDB_type_is_numeric(const RDB_type *);
</pre>

<hr>

<h2 id="type_equals">RDB_type_equals</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_bool
RDB_type_equals(const RDB_type *, const RDB_type *);
</pre>

<hr>

<h2 id="extend_tuple_type">RDB_extend_tuple_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_type *
RDB_extend_tuple_type(const RDB_type *typ, int attrc, RDB_attr attrv[]);
</pre>

<hr>

<h2 id="extend_relation_type">RDB_extend_relation_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

RDB_type *
RDB_extend_relation_type(const RDB_type *typ, int attrc, RDB_attr attrv[]);
</pre>

<hr>

<h2 id="project_tuple_type">RDB_project_tuple_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_project_tuple_type(const RDB_type *typ, int attrc, char *attrv[],
                          RDB_type **newtypp);
</pre>

<hr>

<h2 id="project_relation_type">RDB_project_relation_type</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_project_relation_type(const RDB_type *typ, int attrc, char *attrv[],
                          RDB_type **newtypp);
</pre>

<hr>

<h2 id="join_tuple_types">RDB_join_tuple_types</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_join_tuple_types(const RDB_type *typ1, const RDB_type *typ2,
                     RDB_type **newtypp);
</pre>

<hr>

<h2 id="join_relation_types">RDB_join_relation_types</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_join_relation_types(const RDB_type *typ1, const RDB_type *typ2,
                     RDB_type **newtypp);
</pre>

<hr>

<h2 id="define_ro_op">RDB_define_ro_op</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_define_ro_op(const char *name, RDB_attr *argv[], RDB_type *rtyp,
                 const char *libname, const char *symname, const char *arg,
                  RDB_transaction *txp);
</pre>

<hr>

<h2 id="define_upd_op">RDB_define_upd_op</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_define_upd_op(const char *name, RDB_attr *argv[],
                  int updargc, const char *updargv[],
                  const char *libname, const char *symname, const char *arg,
                  RDB_transaction *txp);
</pre>

<hr>

<h2 id="call_ro_op">RDB_call_ro_op</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_call_ro_op(const char *name, int argc, RDB_value *argv[],
               RDB_value *retvalp, RDB_transaction *txp);
</pre>

<hr>

<h2 id="call_upd_op">RDB_call_upd_op</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_call_upd_op(const char *name, int argc, RDB_value *argv[],
                RDB_transaction *txp);
</pre>

<hr>

<h2 id="drop_op">RDB_drop_op</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_drop_op(const char *name, RDB_transaction *txp);
</pre>

<hr>

<h2 id="create_constraint">RDB_create_constraint</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_create_constraint(const char *name, RDB_expression *constr,
                      RDB_transaction *txp);
</pre>

<hr>

<h2 id="drop_constraint">RDB_drop_constraint</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_drop_constraint(const char *name, RDB_transaction *txp);
</pre>

<hr>

<h2 id="create_env">Creating an environment</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_create_env(const char *path, RDB_environment **);
</pre>

<hr>

<h2 id="open_env">Opening an environment</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_open_env(const char *path, RDB_environment **envp);
</pre>

<hr>

<h2 id="close_env">Closing an environment</h2>

<pre>
#include &lt;rel/rdb.h&gt;

int
RDB_close_env(RDB_environment *);
</pre>

<hr>

<h2 id="set_errfile">Setting the error file</h2>

<pre>
#include &lt;rel/rdb.h&gt;
#include &lt;stdio.h&gt;

void
RDB_set_errfile(RDB_environment *, FILE *errfile);
</pre>

<hr>

<h2 id="attr">RDB_attr</h2>

<pre>
typedef struct {
    char *name;
    RDB_type *typ;
    RDB_value *defaultp;
    int options;
} RDB_attr;
</pre>

<hr>

<h2 id="possrep">RDB_possrep</h2>

<pre>
typedef struct {
    char *name;
    int compc;
    RDB_attr *compv;
    RDB_expression *constraintp;
} RDB_possrep;
</pre>

</html>
